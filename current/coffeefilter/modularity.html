<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" class="no-js"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><script>(function(H){H.className=H.className.replace(/\bno-js\b/,'js')})(document.documentElement)</script><title>ChapterÂ 3.Â Modularity</title><link href="../css/pygments.css" rel="stylesheet"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link href="https://purl.org/dc/elements/1.1/" rel="schema.dc"/><meta name="dc.modified" content="2025-10-13T16:12:53Z"/><meta name="generator" content="DocBook xslTNG version 2.5.0 / 855db8f2 / SAXON HE 12.5"/><link href="../css/docbook-toc.css" rel="stylesheet"/><link href="../css/docbook.css" rel="stylesheet" media="screen"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><script src="https://kit.fontawesome.com/498b6706f0.js" type="text/javascript" crossorigin="anonymous"></script><link href="../css/coldark-cold.css" rel="stylesheet"/><link href="../css/nineml.css" rel="stylesheet"/><link href="../css/ninemlset.css" rel="stylesheet"/><link href="../icon/nineml.png" rel="shortcut icon"/><link rel="prev" href="bk04ch02.html"/><link rel="next" href="bk04ch04.html"/><link rel="up" href="index.html"/><link rel="home" href="../index.html"/><script src="../js/persistent-toc.js" defer="defer"></script><script src="../js/copy-verbatim.js" defer="defer"></script><script src="../js/chunk-nav.js" defer="defer"></script><link href="../icon/CoffeeFilter.png" rel="shortcut icon"/><link href="../css/coffeefilter.css" rel="stylesheet"/></head><body class="chapter component"><nav class="top"><span class="nav"><a title="" href="../index.html"><i class="fas fa-home"></i></a>Â <a title="ChapterÂ 2.Â Pragmas" href="bk04ch02.html"><i class="fas fa-arrow-left"></i></a>Â <a title="CoffeeFilter" href="index.html"><i class="fas fa-arrow-up"></i></a>Â <a title="ChapterÂ 4.Â Limitations" href="bk04ch04.html"><i class="fas fa-arrow-right"></i></a></span><span class="title"><i class="title">NineML</i></span></nav><main><section id="cf_modularity" db-chunk="modularity.html" db-id="d491e5462" class="chapter component"><header><h2>ChapterÂ <span class="label">3</span><span class="sep">.Â </span>Modularity</h2></header>


<p>Modularity is an experimental feature introduced in version 3.3.0. Itâ€™s
inspired by <a href="https://homepages.cwi.nl/~steven/Talks/2025/06-06-markupuk/paper.html" class="link">Modular
ixml</a> presented by Steven Pemberton at MarkupUK in 2025, but some of
the details are different. Itâ€™s likely, if the 
<a href="https://www.w3.org/community/ixml/" class="link">Community Group</a> continues
to work on modularity as a feature of iXML, that the design will change further.
Places where this design differs from the design presented in <cite class="citetitle">Modular ixml</cite>
are marked with â€œğŸ‘€â€ to draw your attention.
</p>

<p>The idea behind modularity is to enable reuse. As the number and
complexity of iXML grammars grows, good software design practice
encourages reusablity with a mechanism more reliable than
â€œcut-and-pasteâ€ between grammars.</p>

<p>Conceptually, modularity constructs a new (monolithic) grammar
that contains all of the necessary productions. It isnâ€™t a textual
inclusion of any kind. Grammars can use each other more-or-less arbitrarily.</p>

<p>Modularity extends the iXML grammar by adding <code class="literal">uses</code> and
<code class="literal">shares</code> elements. These extensions are introduced by a â€œ<code>+</code>â€
as shown in this example:</p>

<div id="ex.mod.numerics" class="example formalobject"><header><div class="title">ExampleÂ <span class="label">3<span class="sep">.</span>1</span><span class="sep">.Â </span>A modular grammar for numbers, <code class="filename">numerics.ixml</code></div></header>

<div class="pre-wrap programlisting-wrap"><pre class="language-none programlisting verbatim verblines"><span class="line"><span class="ld"><code>+uses digit, hexdigit from "digits.ixml" .</code></span></span>
<span class="line"><span class="ld"><code>+shares decimal, hexadecimal .</code></span></span>
<span class="line"><span class="ld"><code> </code></span></span>
<span class="line"><span class="ld"><code>number = decimal | hexadecimal .</code></span></span>
<span class="line"><span class="ld"><code> </code></span></span>
<span class="line"><span class="ld"><code>decimal = digit+ .</code></span></span>
<span class="line"><span class="ld"><code>hexadecimal = hexdigit+ .</code></span></span></pre></div>
</div>

<p>The <code class="literal">uses</code> clause says that this grammar
<em>uses</em> the rules for <code class="literal">digit</code> and
<code class="literal">hexdigit</code> from the <code class="filename">digits.ixml</code>
grammar. It <em>shares</em> the rules for
<code class="literal">decimal</code> and <code class="literal">hexadecimal</code>.
</p>

<p>A grammar with an explicit shares clause is publishing its interface. Only
the explicitly shared symbols may be used by another grammar. If thereâ€™s no shares
clause, ğŸ‘€ any symbol may be used by another grammar.</p>

<p>The effect of requesting modularity is to ğŸ‘€ parse the input grammar against
a variant iXML grammar that defines a <code class="literal">module</code>. The relevant
productions are:</p>

<div class="pre-wrap programlisting-wrap"><pre class="language-none programlisting verbatim verblines"><span class="line"><span class="ld"><code>       module: s, (prolog, RS)?, (( ((uses; shares), RS)+, ixml) | ixml) .</code></span></span>
<span class="line"><span class="ld"><code>         uses: -"+uses", RS, mfrom++(-";", s), s, -'.' .</code></span></span>
<span class="line"><span class="ld"><code>       shares: -"+shares", RS, entries, s, -'.' .</code></span></span>
<span class="line"><span class="ld"><code>   mfrom&gt;from: entries, RS, -"from", RS, source.</code></span></span>
<span class="line"><span class="ld"><code>     -entries: share++(-",", s).</code></span></span>
<span class="line"><span class="ld"><code>        share: @name.</code></span></span>
<span class="line"><span class="ld"><code>      @source: string .</code></span></span></pre></div>

<p>As with a normal iXML grammar, the prolog comes first.  In a module, thatâ€™s
followed by optional uses and shares clauses that may be repeated, followed by
the iXML itself. The ğŸ‘€ grammar URIs are quoted and ğŸ‘€ each clause ends with a full stop.</p>

<p>It is an error to define a rule for a symobol that is used from another grammar.</p>

<p>It is an error to attempt to use a clause from another grammar if that grammar does
not share the symbol (or if no symbols are explicitly shared, if the grammar does not contain 
a rule the symbol).</p>

<p>To complete the example above, <code class="filename">digits.ixml</code> is shown in
<a href="#ex.mod.digits" class="xref xref-example">ExampleÂ <span class="label">3<span class="sep">.</span>2</span>, â€œA modular grammar for digits, <code class="filename">digits.ixml</code>â€</a> and <code class="filename">partno.ixml</code> is show in
<a href="#ex.mod.partno" class="xref xref-example">ExampleÂ <span class="label">3<span class="sep">.</span>3</span>, â€œA modular grammar for part numbers, <code class="filename">partno.ixml</code>â€</a>.</p>

<div id="ex.mod.digits" class="example formalobject"><header><div class="title">ExampleÂ <span class="label">3<span class="sep">.</span>2</span><span class="sep">.Â </span>A modular grammar for digits, <code class="filename">digits.ixml</code></div></header>

<div class="pre-wrap programlisting-wrap"><pre class="language-none programlisting verbatim verblines"><span class="line"><span class="ld"><code>+shares digit, hexdigit .</code></span></span>
<span class="line"><span class="ld"><code> </code></span></span>
<span class="line"><span class="ld"><code>-digit = ["0"-"9"] .</code></span></span>
<span class="line"><span class="ld"><code>-hexdigit = digit | hexadecimal .</code></span></span>
<span class="line"><span class="ld"><code>-hexadecimal = ["A"-"F" | "a"-"f" ] .</code></span></span></pre></div>
</div>

<div id="ex.mod.partno" class="example formalobject"><header><div class="title">ExampleÂ <span class="label">3<span class="sep">.</span>3</span><span class="sep">.Â </span>A modular grammar for part numbers, <code class="filename">partno.ixml</code></div></header>

<div class="pre-wrap programlisting-wrap"><pre class="language-none programlisting verbatim verblines"><span class="line"><span class="ld"><code>ixml version "1.1-nineml" .</code></span></span>
<span class="line"><span class="ld"><code> </code></span></span>
<span class="line"><span class="ld"><code>+uses decimal from "numerics.ixml" .</code></span></span>
<span class="line"><span class="ld"><code> </code></span></span>
<span class="line"><span class="ld"><code>partno: -decimal .</code></span></span></pre></div>
</div>

<p>A ğŸ‘€ modular grammar uses the renaming feature and must be in â€œversion 1.1â€. (This is
an arbitrary limitation but reinforces the experimental nature of the feature.)</p>

<p>Observe that the nonterminal <code class="literal">hexadecimal</code> is
used in two grammars and has different definitions. The processor is
responsible for making sure that a correct grammar is constructed. The
renaming feature, introduced recently in Invisible XML, allows the processor to rename
nonterminals while preserving the correct serialization.</p>

<p>The composed grammar is included in the debugging output:</p>

<div class="pre-wrap programlisting-wrap highlight"><pre class="language-xml programlisting verbatim verblines"><span class="line"><span class="ld"><code><span class="nt">&lt;module&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">   </span><span class="nt">&lt;prolog&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">      </span><span class="nt">&lt;version</span><span class="w"> </span><span class="na">string=</span><span class="s">"1.1-nineml"</span><span class="nt">/&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">   </span><span class="nt">&lt;/prolog&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">   </span><span class="nt">&lt;ixml&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">      </span><span class="nt">&lt;rule</span><span class="w"> </span><span class="na">name=</span><span class="s">"partno"</span><span class="nt">&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">         </span><span class="nt">&lt;alt&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">            </span><span class="nt">&lt;nonterminal</span><span class="w"> </span><span class="na">name=</span><span class="s">"decimal"</span><span class="w"> </span><span class="na">mark=</span><span class="s">"-"</span><span class="nt">/&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">         </span><span class="nt">&lt;/alt&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">      </span><span class="nt">&lt;/rule&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">      </span><span class="nt">&lt;rule</span><span class="w"> </span><span class="na">name=</span><span class="s">"number"</span><span class="nt">&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">         </span><span class="nt">&lt;alt&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">            </span><span class="nt">&lt;nonterminal</span><span class="w"> </span><span class="na">name=</span><span class="s">"decimal"</span><span class="nt">/&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">         </span><span class="nt">&lt;/alt&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">         </span><span class="nt">&lt;alt&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">            </span><span class="nt">&lt;nonterminal</span><span class="w"> </span><span class="na">name=</span><span class="s">"hexadecimal"</span><span class="nt">/&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">         </span><span class="nt">&lt;/alt&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">      </span><span class="nt">&lt;/rule&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">      </span><span class="nt">&lt;rule</span><span class="w"> </span><span class="na">name=</span><span class="s">"decimal"</span><span class="nt">&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">         </span><span class="nt">&lt;alt&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">            </span><span class="nt">&lt;repeat1&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">               </span><span class="nt">&lt;nonterminal</span><span class="w"> </span><span class="na">name=</span><span class="s">"digit"</span><span class="nt">/&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">            </span><span class="nt">&lt;/repeat1&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">         </span><span class="nt">&lt;/alt&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">      </span><span class="nt">&lt;/rule&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">      </span><span class="nt">&lt;rule</span><span class="w"> </span><span class="na">name=</span><span class="s">"hexadecimal"</span><span class="nt">&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">         </span><span class="nt">&lt;alt&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">            </span><span class="nt">&lt;repeat1&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">               </span><span class="nt">&lt;nonterminal</span><span class="w"> </span><span class="na">name=</span><span class="s">"hexdigit"</span><span class="nt">/&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">            </span><span class="nt">&lt;/repeat1&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">         </span><span class="nt">&lt;/alt&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">      </span><span class="nt">&lt;/rule&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">      </span><span class="nt">&lt;rule</span><span class="w"> </span><span class="na">name=</span><span class="s">"digit"</span><span class="w"> </span><span class="na">mark=</span><span class="s">"-"</span><span class="nt">&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">         </span><span class="nt">&lt;alt&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">            </span><span class="nt">&lt;inclusion&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">               </span><span class="nt">&lt;member</span><span class="w"> </span><span class="na">from=</span><span class="s">"0"</span><span class="w"> </span><span class="na">to=</span><span class="s">"9"</span><span class="nt">/&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">            </span><span class="nt">&lt;/inclusion&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">         </span><span class="nt">&lt;/alt&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">      </span><span class="nt">&lt;/rule&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">      </span><span class="nt">&lt;rule</span><span class="w"> </span><span class="na">name=</span><span class="s">"hexdigit"</span><span class="w"> </span><span class="na">mark=</span><span class="s">"-"</span><span class="nt">&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">         </span><span class="nt">&lt;alt&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">            </span><span class="nt">&lt;nonterminal</span><span class="w"> </span><span class="na">name=</span><span class="s">"digit"</span><span class="nt">/&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">         </span><span class="nt">&lt;/alt&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">         </span><span class="nt">&lt;alt&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">            </span><span class="nt">&lt;nonterminal</span><span class="w"> </span><span class="na">name=</span><span class="s">"_1_hexadecimal"</span><span class="nt">/&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">         </span><span class="nt">&lt;/alt&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">      </span><span class="nt">&lt;/rule&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">      </span><span class="nt">&lt;rule</span><span class="w"> </span><span class="na">name=</span><span class="s">"_1_hexadecimal"</span><span class="w"> </span><span class="na">alias=</span><span class="s">"hexadecimal"</span><span class="w"> </span><span class="na">mark=</span><span class="s">"-"</span><span class="nt">&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">         </span><span class="nt">&lt;alt&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">            </span><span class="nt">&lt;inclusion&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">               </span><span class="nt">&lt;member</span><span class="w"> </span><span class="na">from=</span><span class="s">"A"</span><span class="w"> </span><span class="na">to=</span><span class="s">"F"</span><span class="nt">/&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">               </span><span class="nt">&lt;member</span><span class="w"> </span><span class="na">from=</span><span class="s">"a"</span><span class="w"> </span><span class="na">to=</span><span class="s">"f"</span><span class="nt">/&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">            </span><span class="nt">&lt;/inclusion&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">         </span><span class="nt">&lt;/alt&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">      </span><span class="nt">&lt;/rule&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="w">   </span><span class="nt">&lt;/ixml&gt;</span></code></span></span>
<span class="line"><span class="ld"><code><span class="nt">&lt;/module&gt;</span></code></span></span></pre></div>

<p>Note how one of the <code class="literal">hexadecimal</code> nonterminals was
renamed. Nonterminals are only renamed if there are collisions and the nonterminals
in the â€œtop levelâ€ grammar are never renamed.</p>

<div class="admonition note"><div><div class="icon">â“˜</div><div class="body"><header><div class="title">Note</div></header><div>
<p>All of the rules from the three grammars are included in the composed
grammar. This is a bug in the current implementation. Itâ€™s harmless, but
nonterminals that are not reachable from shared symbols could easily be
ignored during construction.</p>
</div></div></div></div>

</section></main><nav class="bottom"><div class="navrow"><div class="navleft"><a title="ChapterÂ 2.Â Pragmas" href="bk04ch02.html"><i class="fas fa-arrow-left"></i></a></div><div class="navmiddle"><a title="NineML" href="../index.html"><i class="fas fa-home"></i></a></div><div class="navright"><a title="ChapterÂ 4.Â Limitations" href="bk04ch04.html"><i class="fas fa-arrow-right"></i></a></div></div><div class="navrow"><div class="navleft navtitle"><a href="bk04ch02.html">ChapterÂ <span class="label">2</span><span class="sep">.Â </span>Pragmas</a></div><div class="navmiddle"><a title="CoffeeFilter" href="index.html"><i class="fas fa-arrow-up"></i></a></div><div class="navright navtitle"><a href="bk04ch04.html">ChapterÂ <span class="label">4</span><span class="sep">.Â </span>Limitations</a></div></div><div class="infofooter"><span class="copyrightfooter">Copyright Â© 2022â€“2023 Norman Walsh.</span></div><nav class="tocopen"></nav><nav class="toc"></nav><!-- Hide ToC details from user agents that donâ€™t support JS --><script type="text/html" class="tocopen"><i class="far fa-book"></i></script><script type="text/html" class="toc"><header><span>Table of Contents</span><span class="close"><i class="far fa-window-close"></i></span><p class="ptoc-search"><input class="ptoc-search" placeholder="Search" style="width: 80%"/></p></header><div db-persistent-toc="persistent-toc.html" db-prefix="../">Loadingâ€¦</div></script></nav><script src="../js/sectmarks.js"></script></body></html>